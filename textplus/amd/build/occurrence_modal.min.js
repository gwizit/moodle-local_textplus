define([],function(){function n(){document.getElementById("local-textplus-occurrence-modal").style.display="none"}var H=function(e){try{return decodeURIComponent(Array.prototype.map.call(atob(e),function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join(""))}catch(t){try{for(var n=atob(e),o=new Uint8Array(n.length),r=0;r<n.length;r++)o[r]=n.charCodeAt(r);return"undefined"!=typeof TextDecoder?new TextDecoder("utf-8").decode(o):n}catch(e){return console.error("Base64 decode error:",t,e),"[Error decoding content]"}}},E=function(e,t){t=t||!1;e=(e=e.replace(/[.+?^${}()|[\]\\]/g,"\\$&")).replace(/\*/g,"\\S*");return new RegExp(e,t?"g":"gi")},T=function(e){return-1!==e.indexOf("*")};return{init:function(){var t=document.getElementById("local-textplus-occurrence-modal"),e=document.querySelector(".local-textplus-occurrence-modal-close");e&&e.addEventListener("click",function(){n()}),document.querySelectorAll(".local-textplus-occurrence-link").forEach(function(h){h.addEventListener("click",function(e){e.preventDefault();var e=h,t=document.getElementById("local-textplus-occurrence-modal"),n=document.getElementById("local-textplus-occurrence-modal-title"),o=document.getElementById("local-textplus-occurrence-modal-body-content"),r=e.getAttribute("data-context"),c=e.getAttribute("data-match"),l=e.getAttribute("data-location"),e=e.getAttribute("data-searchterm"),a=H(r),d=H(c),r=H(l),c=e?H(e):d,u=(n.textContent=r,o.textContent="");if(T(c)){var i,s=E(c,!1),g=0;for(s.lastIndex=0;null!==(i=s.exec(a));)u=(u+=a.substring(g,i.index))+("<<<HIGHLIGHT_START>>>"+i[0])+"<<<HIGHLIGHT_END>>>",g=i.index+i[0].length,i.index===s.lastIndex&&s.lastIndex++;u+=a.substring(g)}else for(var m=a.toLowerCase(),f=d.toLowerCase(),g=0;;){var p=m.indexOf(f,g);if(-1===p){u+=a.substring(g);break}u=(u+=a.substring(g,p))+("<<<HIGHLIGHT_START>>>"+a.substring(p,p+d.length)+"<<<HIGHLIGHT_END>>>"),g=p+d.length}for(var x,I=u.split(/<<<HIGHLIGHT_START>>>|<<<HIGHLIGHT_END>>>/),y=0;y<I.length;y++)y%2==1?((x=document.createElement("span")).className="highlight",x.textContent=I[y],o.appendChild(x)):(x=document.createTextNode(I[y]),o.appendChild(x));t.style.display="block"})}),window.addEventListener("click",function(e){e.target===t&&n()}),document.addEventListener("keydown",function(e){"Escape"===e.key&&n()})}}});